# Domain and subdomain for your public access

DOMAIN=fitim.it.com
SUBDOMAIN=webcv
EMAIL=fitim.zulfiu@gmail.com
DOCKER_REPOSITORY=timi74/webcv
IMAGE_TAG=latest
APP_CONTAINER_NAME=webcv-app
APP_NAME=webcv
CLOUDFLARE_URL=https://fitim.it.com
# Cloudflare public API base URL used by the app
CLOUDFLARE_API_URL=https://api.cloudflare.com/client/v4

# Database Configuration

DB_SERVER=webcv-sqlserver
DB_CONTAINER_NAME=webcv-sqlserver
DB_NAME=webcv_db
DB_USER=sa
DB_MEMORY_LIMIT_MB=4096
DB_PORT=14337

# Runtime deploy settings

# Use port 8080 for the application (standard port)
APP_PORT=8090
TEMP_PORT=8072
HEALTH_PATH=/Health
HEALTH_TIMEOUT_SECONDS=180
HEALTH_INTERVAL_SECONDS=5
DB_HEALTH_TIMEOUT_SECONDS=5
COMPOSE_NETWORK=deploy_webcvapp_default
ASPNETCORE_ENVIRONMENT=Production

# User and system configuration
DEPLOY_USER=fitim
DEPLOY_USER_HOME=/home/${DEPLOY_USER}
APP_BASE_DIR=${DEPLOY_USER_HOME}/webcv

# System configuration
DOCKER_GROUP=docker
OS_DISTRO=ubuntu
PORT_CLEANUP_LIST="8080 8081 8082"

# Watchtower Configuration
WATCHTOWER_HTTP_PORT=8071
WATCHTOWER_API_TOKEN=securetoken123
WATCHTOWER_POLL_INTERVAL=300
WATCHTOWER_MAX_WAIT_MINUTES=10
WATCHTOWER_DEBUG=true
WATCHTOWER_TRACE=false
WATCHTOWER_NOTIFICATIONS=
WATCHTOWER_NOTIFICATION_URL=
WATCHTOWER_HTTP_API_URL=http://watchtower:8080

# Cloudflare Tunnel Configuration

CLOUDFLARE_TUNNEL_TOKEN=eyJhIjoiNTU3YTBiYmFkMzYyNDY4ZmE1MDBlMzE1ZDYyODFmZGIiLCJ0IjoiZWU3ODMxOWYtMmJhZC00Y2UxLTgxMDUtZGMyOGE4NTJhZjM0IiwicyI6Ill6Sm1ZVEF4TmpRdE0yTTRNUzAwWWpRNExXRXhObU10TUdZNE1qVmtabU13TnpSaiJ9
TUNNEL_NAME=webcv
CF_API_TOKEN=Co6HKoVfb5JjSFtafFq2wMftZmidb_sLlQX0As06
CF_ZONE_ID=cfff9e7d0d62dafd3154df6cebfb4df5
CLOUDFLARED_DIR=${DEPLOY_USER_HOME}/.cloudflared

# Health tuning

HEALTH_RETRY_INTERVAL_SECONDS=10
HEALTH_RETRIES=3
HEALTH_START_PERIOD_SECONDS=60

# Host-side absolute paths for bind mounts (Docker host filesystem)
# These paths are now configurable via APP_BASE_DIR
HOST_LOGS_DIR=${APP_BASE_DIR}/logs
HOST_DATA_DIR=${APP_BASE_DIR}/data
HOST_BACKUPS_DIR=${APP_BASE_DIR}/backups
HOST_KEYS_DIR=${APP_BASE_DIR}/dataprotection-keys
HOST_PRODUCTIMAGES_DIR=${APP_BASE_DIR}/wwwroot/ProductImages
HOST_USERIMAGES_DIR=${APP_BASE_DIR}/wwwroot/UsersImages
HOST_STATIC_IMAGES_DIR=${APP_BASE_DIR}/wwwroot/images

# Volume mount paths (use HOST paths for proper persistence)
APP_LOGS_DIR=${HOST_LOGS_DIR}
APP_DATA_DIR=${HOST_DATA_DIR}
APP_BACKUPS_DIR=${HOST_BACKUPS_DIR}
APP_KEYS_DIR=${HOST_KEYS_DIR}
APP_PRODUCTIMAGES_DIR=${HOST_PRODUCTIMAGES_DIR}
APP_USERIMAGES_DIR=${HOST_USERIMAGES_DIR}
APP_STATIC_IMAGES_DIR=${HOST_STATIC_IMAGES_DIR}

# Kestrel/timeout (optional)

DOCKER_CONN_TIMEOUT_SEC=60
KESTREL_KEEPALIVE_SEC=300
KESTREL_REQHDR_TIMEOUT_SEC=300
KESTREL_MAX_REQLINE_BYTES=16384
KESTREL_MAX_REQBUF_BYTES=1048576

# HTTP Client timeouts
DEFAULT_HTTP_CLIENT_TIMEOUT_MINUTES=10
CLOUDFLARE_HTTP_CLIENT_TIMEOUT_MINUTES=5
DOCKER_REGISTRY_HTTP_TIMEOUT_SECONDS=30

# SignalR Configuration
SIGNALR_CLIENT_TIMEOUT_MINUTES=5
SIGNALR_HANDSHAKE_TIMEOUT_MINUTES=1
SIGNALR_MAX_MESSAGE_SIZE=1048576
SIGNALR_STREAM_BUFFER_CAPACITY=10
SIGNALR_MAX_PARALLEL_INVOCATIONS=1

# Database Configuration
DB_MAX_RETRY_COUNT=5
DB_MAX_RETRY_DELAY_SECONDS=30
DB_COMMAND_TIMEOUT_SECONDS=60

TUNNEL_ID=0529e7af-e02c-4290-bf5e-ea1e696a7214

# Post-Deployment Refresh Configuration (Watchtower)
# These settings control the automatic page refresh after successful deployment

# Server-side health check settings (before sending RefreshPage signal)
POST_DEPLOY_REFRESH_DELAY_MS=5000                # Wait 5 seconds at 100% before health checks
POST_DEPLOY_HEALTH_TIMEOUT_MS=60000              # Maximum time to wait for container health (60 seconds)
POST_DEPLOY_HEALTH_INTERVAL_MS=2000              # Check health every 2 seconds
POST_DEPLOY_HEALTH_CONSEC_OK=5                   # Require 5 consecutive successful checks (10 seconds of stability)

# Client-side settings are in deployment.js:
# - minWaitBeforeHealthCheckMs: 20000 (20 second buffer before client checks)
# - checkIntervalMs: 3000 (check every 3 seconds)
# - consecutiveHealthChecks: 3 (require 3 consecutive OK checks)

# Legacy deployment configuration (kept for compatibility but not used with Watchtower)
TEMP_CONTAINER_NAME=webcv-app-temp
FINAL_CONTAINER_NAME_TEMPLATE=webcv-app-final-{imageTag}
MAX_DEPLOYMENT_MESSAGES=100
STATUS_UPDATE_INTERVAL_SECONDS=30
DOCKER_STOP_TIMEOUT_SECONDS=5
ORPHANED_CONTAINER_PATTERNS=webcv-app-temp,webcv-app-final
CONTAINER_NEW_NAME_TEMPLATE={containerName}-new-{timestamp}
DEPLOYMENT_LOOP_DELAY_SECONDS=5
HEALTH_CHECK_STARTUP_DELAY_SECONDS=30
HEALTH_CHECK_MIN_TIMEOUT_SECONDS=5
HEALTH_CHECK_MAX_TIMEOUT_SECONDS=30
HEALTH_CHECK_MIN_RETRY_DELAY_SECONDS=1
HEALTH_CHECK_RETRY_ATTEMPTS=5
HEALTH_CHECK_RETRY_DELAY_SECONDS=10
CONTAINER_LOG_TAIL_LINES=50
DEPLOYMENT_LOCK_TIMEOUT_SECONDS=1
UI_UPDATE_DELAY_MILLISECONDS=1000

# Docker socket paths
DOCKER_SOCKET_WINDOWS=\\.\pipe\docker_engine
DOCKER_SOCKET_UNIX=/var/run/docker.sock
DB_PASSWORD=WebCV_SecurePass_2024
